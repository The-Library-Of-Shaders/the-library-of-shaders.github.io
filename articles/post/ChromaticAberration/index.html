<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Chromatic Aberration - The Library Of Shaders</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" disabled>
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" >
        <link href="../../../css/custom.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">The Library Of Shaders</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Shaders</a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Vertex Shaders</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../vertex/" class="dropdown-item">Index</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Fragment Shaders</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../fragment/" class="dropdown-item">Index</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Post Processing</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../" class="dropdown-item">Index</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Chromatic Aberration</a>
</li>
            
<li>
    <a href="../Bloom/" class="dropdown-item">Bloom</a>
</li>
            
<li>
    <a href="../Vignette/" class="dropdown-item">Vignette</a>
</li>
            
<li>
    <a href="../GaussianBlur/" class="dropdown-item">Gaussian Blur</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Bloom/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../../../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#chromatic-aberration" class="nav-link">Chromatic Aberration</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#edge-strengthing" class="nav-link">Edge Strengthing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#full-program" class="nav-link">Full Program</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="chromatic-aberration">Chromatic Aberration</h1>
<p>Chromatic Aberration is an effect commonly observed in images, when the camera can't focus all color channels onto a point. This results in different colors being in slightly different positions.</p>
<p>In shaders, this effect can be simulated by offsetting the position at which we sample each color channel. This is quite simple, but the value by which you offset needs to be quite small in order to look any good.</p>
<p>Let's first assume a couple variables we have access to.</p>
<ul>
<li><code>fragCoord</code></li>
<li><code>iResolution</code></li>
</ul>
<p>These are explained on the home page, under variables.</p>
<p>Let's grab the normalized coordinates of our pixel. Since <code>fragCoord</code> ranges from 0 to the screen dimensions, we just need to divide by the screen dimensions.</p>
<pre><code class="language-js">vec2 normalizedCoords = fragCoord/iResolution.xy;
</code></pre>
<p>Now let's define some small offsets.</p>
<pre><code class="language-js">vec2 redOffset = vec2(0.001, 0.002);
vec2 greenOffset = vec2(-0.002, 0.001);
vec2 blueOffset = vec2(0.003, 0.002);
</code></pre>
<p>Now that we have some offsets, we can just sample our texture with them. Assuming we have a texture sampler called <code>iChannel0</code>:</p>
<pre><code class="language-js">float red = texture(iChannel0, normalizedCoords + redOffset).r;
float green = texture(iChannel0, normalizedCoords + greenOffset).g;
vec2 blueAlpha = texture(iChannel0, normalizedCoords + blueOffset).ba;
</code></pre>
<p>Using <a href="https://en.wikipedia.org/wiki/Swizzling_(computer_graphics)">swizzling</a>, or accessing only a specific component of a vector, we can easily get only the value we need. Notice that for the last channel, I use a vec2 instead of a float, because, of course, we need to get the alpha channel as well. We'll just use the blue offset to sample the alpha channel.</p>
<p>Now, we can join it all together.</p>
<pre><code class="language-js">fragColor = vec4(red, green, blueAlpha);
</code></pre>
<h2 id="edge-strengthing">Edge Strengthing</h2>
<p>So, we've constructed our output color with the offset channels. This is oftentimes enough, but realistically, you'll only see chromatic aberration near the very edges of images, and not so much at the center.</p>
<p>To make this effect more realistic, we can simulate that.</p>
<p>We have the current normalized position in <code>normalizedCoords</code>. At the moment this ranges from 0 to 1, but with a bit of clever math we can get something cool.</p>
<p>First, let's shift our coordinates over.</p>
<pre><code class="language-js">vec2 shiftedCoords = normalizedCoords - 0.5;
</code></pre>
<p>So now, the coordinates range from -0.5 to 0.5. We're close now, we just need to take the absolute value of the coordinates to get rid of that negative.</p>
<pre><code class="language-js">shiftedCoords = abs(shiftedCoords);
</code></pre>
<p>Now, let's edit our previous texture sampling code.</p>
<pre><code class="language-js">float red = texture(iChannel0, normalizedCoords + (shiftedCoords * redOffset)).r;
float green = texture(iChannel0, normalizedCoords + (shiftedCoords * greenOffset)).g;
vec2 blueAlpha = texture(iChannel0, normalizedCoords + (shiftedCoords * blueOffset)).ba;
</code></pre>
<p>So, you see, the values range from 0.5 at the bottom left, to 0.5 at the top right. This means that in the center, the values are 0.0, or around it. We're effectively reducing our offset by how close it is to the center. </p>
<p>This means that the effect will only really be visible around the edges, which is exactly what we want.</p>
<p>However, it's probably not going to be that visible, as we've effectively halved it, seeing as how we're multiplying by at most, 0.5. So, we can modify our absolute value line to increase it.</p>
<pre><code class="language-js">shiftedCoords = abs(shiftedCoords) * 2.0;
</code></pre>
<p>Doubling it brings it back to the original strength, but you can increase or decrease this however you want to tweak the strength.</p>
<h2 id="full-program">Full Program</h2>
<pre><code class="language-js">const float STRENGTH = 2.0;

void mainImage( out vec4 fragColor, in vec2 fragCoord )
{
    vec2 normalizedCoords = fragCoord/iResolution.xy;

    vec2 redOffset = vec2(0.001, 0.002);
    vec2 greenOffset = vec2(-0.002, 0.001);
    vec2 blueOffset = vec2(0.003, 0.002);

    vec2 shiftedCoords = normalizedCoords - 0.5;

    shiftedCoords = abs(shiftedCoords) * STRENGTH;

    float red = texture(iChannel0, normalizedCoords + (shiftedCoords * redOffset)).r;
    float green = texture(iChannel0, normalizedCoords + (shiftedCoords * greenOffset)).g;
    vec2 blueAlpha = texture(iChannel0, normalizedCoords + (shiftedCoords * blueOffset)).ba;

    fragColor = vec4(red, green, blueAlpha);
}
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js"></script>
        <script src="../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
